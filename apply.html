<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Upload</title>

    <!-- Axios for API Requests -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- EmailJS Integration -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        (function() {
            emailjs.init("Rvp4yKDqi42mqo3oz"); // ✅ Ensure this is your actual EmailJS user ID
        })();
    </script>

    <!-- CSS File -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="upload-container">
    <h2>Upload Your Resume</h2>
    <form id="uploadForm" enctype="multipart/form-data" onsubmit="sendEmailAndWhatsApp(event)">
        
        <h3>Basic Information</h3>
        <input type="text" name="name" placeholder="Full Name" required />
        <input type="email" name="email" placeholder="Email" required />
        <input type="text" name="role" placeholder="Role" required />
        <input type="text" name="phone" placeholder="Phone Number" required />
        <select name="gender" required>
            <option value="">Select Gender</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
        </select>
        <input type="date" name="dob" required />
        <textarea name="address" placeholder="Enter your address" rows="2" required></textarea>
        <textarea name="description" placeholder="Short Description" rows="3"></textarea>

        <h3>Education</h3>
        <div id="education-section">
            <div class="education-entry">
                <input type="text" name="degree[]" placeholder="Degree (e.g. B.Sc.)" required />
                <input type="text" name="institution[]" placeholder="Institution Name" required />
                <input type="number" name="year[]" placeholder="Year of Completion" required />
                <button type="button" class="add-btn" onclick="addEducation()">+ Add</button>
            </div>
        </div>

        <h3>Skills</h3>
        <div id="skills-section">
            <div class="skill-entry">
                <input type="text" name="skill[]" placeholder="Skill (e.g. JavaScript)" required />
                <input type="number" name="proficiency[]" placeholder="Proficiency (%)" min="1" max="100" required />
                <button type="button" class="add-btn" onclick="addSkill()">+ Add</button>
            </div>
        </div>

        <h3>Resume Upload</h3>
        <input type="file" name="resume" accept=".pdf" required />

        <button type="submit">Submit Application</button>
    </form>
</div>

<script>
  function addEducation() {
      const section = document.getElementById('education-section');
      const div = document.createElement('div');
      div.classList.add('education-entry');
      div.innerHTML = `
          <input type="text" name="degree[]" placeholder="Degree" required />
          <input type="text" name="institution[]" placeholder="Institution Name" required />
          <input type="number" name="year[]" placeholder="Year of Completion" required />
          <button type="button" class="remove-btn" onclick="removeEntry(this)">- Remove</button>
      `;
      section.appendChild(div);
  }

  function addSkill() {
      const section = document.getElementById('skills-section');
      const div = document.createElement('div');
      div.classList.add('skill-entry');
      div.innerHTML = `
          <input type="text" name="skill[]" placeholder="Skill" required />
          <input type="number" name="proficiency[]" placeholder="Proficiency (%)" min="1" max="100" required />
          <button type="button" class="remove-btn" onclick="removeEntry(this)">- Remove</button>
      `;
      section.appendChild(div);
  }

  function removeEntry(button) {
      button.parentElement.remove();
  }

  async function sendEmailAndWhatsApp(event) {
    event.preventDefault();

    const form = document.getElementById('uploadForm');
    const formData = new FormData(form);
    const fileInput = form.querySelector('input[name="resume"]');

    if (!fileInput.files.length) {
        alert('Please upload your resume.');
        return;
    }

    try {
        // ✅ Upload resume to Cloudinary
        const cloudinaryData = new FormData();
        cloudinaryData.append("file", fileInput.files[0]);
        cloudinaryData.append("upload_preset", "resume_upload");

        const cloudinaryResponse = await axios.post(
            'https://api.cloudinary.com/v1_1/dzehqrwmd/upload', 
            cloudinaryData
        );

        const resumeUrl = cloudinaryResponse.data.secure_url;

        // ✅ Collect Education Entries
        const educationEntries = [];
        const institutionNames = [];
        const years = [];

        document.querySelectorAll('.education-entry').forEach(entry => {
            const degree = entry.querySelector('input[name="degree[]"]').value.trim();
            const institution = entry.querySelector('input[name="institution[]"]').value.trim();
            const year = entry.querySelector('input[name="year[]"]').value.trim();

            if (degree && institution && year) {
                educationEntries.push(`${degree} from ${institution} (${year})`);
            }
        });

        // ✅ Collect Skills Entries
        const skillEntries = [];
        const proficiencies = [];

        document.querySelectorAll('.skill-entry').forEach(entry => {
            const skill = entry.querySelector('input[name="skill[]"]').value.trim();
            const proficiency = entry.querySelector('input[name="proficiency[]"]').value.trim();

            if (skill && proficiency) {
                skillEntries.push(`${skill} - ${proficiency}%`);
                proficiencies.push(proficiency);
            }
        });

        // ✅ Prepare Data for EmailJS
        const emailParams = {
            name: formData.get('name') || "Not provided",
            email: formData.get('email') || "Not provided",
            role: formData.get('role') || "Not provided",
            phone: formData.get('phone') || "Not provided",
            gender: formData.get('gender') || "Not provided",
            dob: formData.get('dob') || "Not provided",
            address: formData.get('address') || "Not provided",
            description: formData.get('description') || "Not provided",
            degree: educationEntries.length > 0 ? educationEntries.join("\n") : "Not provided",
            skill: skillEntries.length > 0 ? skillEntries.join("\n") : "Not provided",
            resume_url: resumeUrl 
        };

        // ✅ Send email via EmailJS
        await emailjs.send('service_68r0dmm', 'template_bihfita', emailParams);
        alert('Resume sent successfully via Email!');

    } catch (error) {
        console.error('Error uploading file or sending message:', error);
        alert('Failed to upload file or send message. Please try again.');
    }
}

</script>

</body>
</html>
